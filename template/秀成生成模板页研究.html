<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="screen-orientation" content="portrait">
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<title>活动框架</title>
<style>
@charset "utf-8";
/* CSS Document */
* { margin:0; padding:0; font-weight:normal;}
body { font-family:"微软雅黑"; font-size:12px; position:relative;}
li { list-style:none;}
.insl , insl2 { padding-top:15px;}
.input { position:relative; width:66%; margin:15%; padding:5% 2%;}
	.input input { width:85%; height:40px; line-height:40px; padding:0 2.5%; margin:0 auto; display:block;}
	.input span { position:absolute; line-height:40px; margin:0px 0 0 -20px;}
	.input span.long { margin-left:-30px;}
	.swiper-slide { background-size:100% 100%;}
	.textarea { display:none; width:95%; padding:2.5%; line-height:25px; border:#ccc 1px solid; white-space:pre-wrap; max-height:500px; overflow:scroll; overflow-x:hidden;}
	.main { color:#f00; line-height:25px; line-height:25px; padding-top:30px;}
	.n { display:inline-block; text-align: justify; width:100px;}
	.share { display:block;}
	.share .insl2 { display:none;}
	.xhtml { display:none;}
	.html { width:375px; height:667px; overflow:hidden; border:#ccc 1px solid; margin:0 auto;}
</style>
<style>* { padding:0; margin:0;}.swiper-slide { background-size:100% 100%;}</style>
<link href="<{asset:u/css/201509/swiper3.07.min.css}>" type="text/css">
<script src="<{asset:u/js/201509/zepto.min.js}>"></script>
<script src="<{asset:u/js/201509/swiper3.07.jquery.min.js}>"></script>
<script>
// JavaScript Document
var html = ""
var header = '<!doctype>\n\
<html>\n\
<head>\n\
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n\
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">\n\
<meta name="apple-mobile-web-app-capable" content="yes">\n\
<meta name="screen-orientation" content="portrait">\n\
<meta name="apple-mobile-web-app-status-bar-style" content="black" />\n\
<meta name="apple-mobile-web-app-status-bar-style" content="black" />\n\
<meta http-equiv="X-UA-Compatible" content="IE=edge">\n\
<meta name="format-detection" content="telephone=no">\n'	 
var style ='<style>* { padding:0; margin:0;}.swiper-slide { background-size:100% 100%;}</style>'

var file = {
	swiper :　{
		css : '{asset:u/css/201509/swiper3.07.min.css}',
		zepto : "{asset:u/js/201509/zepto.min.js}",
		js  : "{asset:u/js/201509/swiper3.07.jquery.min.js}",
		call : function(name,id,direction,h) {
				//horizontal + vertical
			    !direction && (direction = 'vertical');
				var height;
				h ? height = 'var height = ' + h : height = 'var height = $("body").height()';
				var jsHtml = '<script>\n'+height+'\nvar '+name+' = new Swiper (".'+id+'", {\ndirection: "'+direction+'",\neffect : "effect",\nnoSwipingClass : "stop-swiping",\nheight :　height,\nloop:false})\n<\/script>'
				return jsHtml;
			},
	  inHtml : 'swiper-wrapper',
	  page : ['swiper-slide','swiper-slide'],
	  box : "swiper-wrapper"
	}
}

var share = {
		shareImg : function(url) {
			if($(".shareImg").val() != "") {return '<img src="'+url+'" style="position:fixed;left:-100%;" />'} else {return}
			
		},
		shareApp : function(url,h1,h2) {
			if($(".h1").val() != "") {
				return '<iframe frameborder="0" style="display: none;" id="share_iframe"></iframe>\n\
<script>\n\
var _protocolLink = "yongche://share?";\n\
var _protocolLinkFriend = "yongche://shareToFriend?";\n\
var _protocolLinkTimeline = "yongche://shareToTimeline?";\n\
var shareRead_link = encodeURIComponent("window.location");\n\
var shareRead_pics = encodeURIComponent("'+url+'");\n\
var shareRead_title = encodeURIComponent("'+h1+'");\n\
var shareRead_content = encodeURIComponent("'+h2+'");\n\
var shareRead_sourceType = 42;\n\
var shareRead_callback = "share_callback";\n\
var Tools = {\n\
	shareThisPage:function(){\n\
		var _str = "link="+shareRead_link+"&pics="+shareRead_pics+"&title="+shareRead_title+"&content="+shareRead_content+"&sourceType="+shareRead_sourceType+"&callback="+shareRead_callback;\n\
		var _tmpOpenLink = _protocolLink + _str;\n\
		window.location.href = _tmpOpenLink;\n\
	},\n\
	shareThisPageToTimeline:function(){\n\
		var _str = "link="+shareRead_link+"&pics="+shareRead_pics+"&title="+shareRead_title+"&content="+shareRead_content+"&sourceType="+shareRead_sourceType+"&callback="+shareRead_callback;\n\
		var _tmpOpenLink = _protocolLinkTimeline + _str;\n\
		window.location.href = _tmpOpenLink;\n\
	}\n\
};\n\
var _str = "link="+shareRead_link+"&pics="+shareRead_pics+"&title="+shareRead_title+"&content="+shareRead_content+"&sourceType="+shareRead_sourceType+"&from=iframe"+"&callback="+shareRead_callback;\n\
var _tmpOpenLink = _protocolLink + _str;\n\
document.getElementById("share_iframe").src = _tmpOpenLink;\n\
Do("c.common",function(){\n\
	document.getElementById("share_btn").onclick=function(){\n\
		Tools.shareThisPage();\n\
	};\n\
});\n\
Do("c.common",function(){\n\
	document.getElementById("share_btn_timeline").onclick=function(){\n\
		Tools.shareThisPageToTimeline();\n\
	};\n\
});\n\
<\script>\n'
			} else {return ""}	
		}
}
</script>
</head>

<body> 
	<div class="input">
    	<span class="long">项目名称 ：</span><input type="text" class="name" placeholder="项目名称" /> <br/>
        <div class="insl">
            <span>第一屏 ：</span><input type="text" class="string1" placeholder="第一屏" /> <br/>
            <span>第二屏 ：</span><input type="text" class="string2" placeholder="第二屏" /> <br/>
            <span>第三屏 ：</span><input type="text" class="string3" placeholder="第三屏" /> <br/>
            <span>第四屏 ：</span><input type="text" class="string4" placeholder="第四屏" /> <br/>
            <span>第五屏 ：</span><input type="text" class="string4" placeholder="第五屏" /> <br/>
            <span>第六屏 ：</span><input type="text" class="string4" placeholder="第六屏" /> <br/>
        </div>
        <div class="share">
        	<span>分享：</span><input type="checkbox" id="checkbox"><br/>
            <div class="insl2">
                <span class="long">分享图片 ：</span><input type="text" class="shareImg" placeholder="分享图片" /> <br/>
                <span>主标题 ：</span><input type="text" class="h1" placeholder="主标题" /> <br/>
                <span>副标题 ：</span><input type="text" class="h2" placeholder="副标题" /> <br/>
            </div>
        </div>
        <input type="submit" value="预览" /> <br/> <br/> <br/>
        <div class="xhtml">
        	<div class="html"></div> <br/> <br/>
        	<input type="submit" value="确定生成" /> <br/>
        </div>
        <pre class="textarea"></pre>
        <div class="main">
        	<h2>填写规则</h2>
            项目名称为网站title,用于网站显示名称,为必填项<br/>
            屏类输入框为每屏的内容，格式为url,url，不填默认没有！<br/>
            url 的 格式可以为cms  也可以是绝对路径！<br/>
            例： cms类路径 ：<font>{asset:u/images/201509/954608638.png}</font> <br/>
            绝对路径：http://www.yongche.com/logo.jpg<br/><br/>
            点击分享按钮打开分享功能<br/>
            不填主标题 副标题则只有微信分享<br/>
            如果副标题想为空，则填写空格则可
        </div>
    </div>
	<script>
		$(".main font").html("<" + $(".main font").html() + ">")
		var local = window.location.href.split("/cms")[0].split(".")[2];
		var url = 'http://zhangzhong.backend.yongche.'+local+'/cms/doedit';
		$("#checkbox").on("click",function() {
			$(".share .insl2").toggle();
		})
		$("input[type='submit']").on("click",function() {
			html = "";
			if($(".name").val() == "") {
				alert("请输入项目名称");
				return;
			}
			if($(".string1").val() == "") {
				alert("请输入项目名称");
				return;
			}
			if($("#checkbox").attr("checked")) {
				if($(".shareImg").val() == "") {
					alert("请输入分享图片");
					return;
				}
				if($(".h1").val() != "" && $(".h2").val() == "") {
					alert("请输入副标题");
					return;
				}
				if($(".h2").val() != "" && $(".h1").val() == "") {
					alert("请输入主标题");
					return;
				}
			}
			var str = "";
			for(var i=0;i<$(".insl input").size();i++) {
				if($(".insl input").eq(i).val() != "") {
					str == "" ? str = $(".insl input").eq(i).val() : str += "*" + $(".insl input").eq(i).val()
				}
			}
			
			if($(this).val() == "确定生成") {
				name = $(".name").val();
				html += header + '<title>'+name+'<\/title>\n<link rel="stylesheet" type="text/css" href="<'+file.swiper.css+'>" \/>\n<script src="<'+file.swiper.zepto+'>"><\/script>\n<script src="<'+file.swiper.js+'>"><\/script>\n'+style+'\n<\/head>\n<body>\n'+share.shareImg($(".shareImg").val())+'\n<div class="swiper-container">\n<div class="swiper-wrapper">\n';
				//$("input[type='submit']").attr("disabled","");
				var page = str.split('*');
				for(i=0;i<page.length;i++){
					var s;
					if(page[i].split(",").length == 1) {
						html += addShtml(page[i]) } else {
						html += '<div class="swiper-slide">\n<div class="swiper-container'+i+'">\n<div class="swiper-wrapper">';
						for(var j=0;j<page[i].split(",").length;j++) {
							html +=addShtml(page[i].split(",")[j])
						}
						!s && (s = "horizontal");
						html += '<\/div>\n<\/div>\n<\/div>'+file.swiper.call("mySwiper"+i,"swiper-container"+i,s);
					}
				}
				html += '</div>\n</div>\n</div>\n'+file.swiper.call("mySwiper","swiper-container")+'\n'+ share.shareApp($(".shareImg").val(),$(".h1").val(),$(".h2").val()) +'</body>\n</html>';
				$(".html").hide();
				$(".textarea").text(html).show();
			} else {
				html += '\n<div class="swiper-container">\n<div class="swiper-wrapper">\n';
				var page = str.split('*');
				for(i=0;i<page.length;i++){
					var s;
					if(page[i].split(",").length == 1) {
						html += addShtml(page[i],1) } else {
						html += '<div class="swiper-slide">\n<div class="swiper-container'+i+'">\n<div class="swiper-wrapper">';
						for(var j=0;j<page[i].split(",").length;j++) {
							html +=addShtml(page[i].split(",")[j],1)
						}
						!s && (s = "horizontal");
						html += '<\/div>\n<\/div>\n<\/div>'+file.swiper.call("mySwiper"+i,"swiper-container"+i,s);
					}
				}
				html += '</div>\n</div>\n</div>\n'+file.swiper.call("mySwiper","swiper-container","",667)+'\n'+ share.shareApp($(".shareImg").val(),$(".h1").val(),$(".h2").val());
				$(".textarea").hide();
				$(".xhtml").show().find(".html").html(html);
			}
		})
		
		function addShtml(val,preview) {
			preview && val.split("<{").length > 1 && (val = 'http://i1.'+ 'yongche.name' +'/u/images/' + val.split("media/")[1].split("}>")[0]);
			return  '<div class="swiper-slide"  style="background-image:url('+val+')"></div>\n';
		}
		
	</script>
</body>
</html>
